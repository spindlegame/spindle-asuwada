<?php
// This script and data application were generated by AppGini 5.94
// Download AppGini for free from https://bigprof.com/appgini/download/

	$currDir = dirname(__FILE__);
	include_once("$currDir/lib.php");

	handle_maintenance();

	header('Content-type: text/javascript; charset=' . datalist_db_encoding);

	$table_perms = getTablePermissions('hist_chr_scene');
	if(!$table_perms['access']) die('// Access denied!');

	$mfk = $_GET['mfk'];
	$id = makeSafe($_GET['id']);
	$rnd1 = intval($_GET['rnd1']); if(!$rnd1) $rnd1 = '';

	if(!$mfk) {
		die('// No js code available!');
	}

	switch($mfk) {

		case 'author_id':
			if(!$id) {
				?>
				$j('#author_name<?php echo $rnd1; ?>').html('&nbsp;');
				<?php
				break;
			}
			$res = sql("SELECT `hist_author`.`id` as 'id', IF(    CHAR_LENGTH(`hist_team1`.`id`) || CHAR_LENGTH(`hist_team1`.`team`), CONCAT_WS('',   `hist_team1`.`id`, ' - ', `hist_team1`.`team`), '') as 'team', IF(    CHAR_LENGTH(`game_agent1`.`id`) || CHAR_LENGTH(`game_agent1`.`memberID`), CONCAT_WS('',   `game_agent1`.`id`, '   ', `game_agent1`.`memberID`), '') as 'agent_id', IF(    CHAR_LENGTH(`game_agent1`.`memberID`), CONCAT_WS('',   `game_agent1`.`memberID`), '') as 'agent_memberid', IF(    CHAR_LENGTH(`game_agent1`.`last_name`), CONCAT_WS('',   `game_agent1`.`last_name`), '') as 'last_name', IF(    CHAR_LENGTH(`game_agent1`.`first_name`), CONCAT_WS('',   `game_agent1`.`first_name`), '') as 'first_name' FROM `hist_author` LEFT JOIN `hist_team` as hist_team1 ON `hist_team1`.`id`=`hist_author`.`team` LEFT JOIN `game_agent` as game_agent1 ON `game_agent1`.`id`=`hist_author`.`agent_id`  WHERE `hist_author`.`id`='{$id}' limit 1", $eo);
			$row = db_fetch_assoc($res);
			?>
			$j('#author_name<?php echo $rnd1; ?>').html('<?php echo addslashes(str_replace(array("\r", "\n"), '', nl2br($row['last_name'].', '.$row['first_name']))); ?>&nbsp;');
			<?php
			break;

		case 'agent_id':
			if(!$id) {
				?>
				$j('#agent_name<?php echo $rnd1; ?>').html('&nbsp;');
				<?php
				break;
			}
			$res = sql("SELECT `game_agent`.`id` as 'id', `game_agent`.`user_id` as 'user_id', `game_agent`.`memberID` as 'memberID', `game_agent`.`img` as 'img', `game_agent`.`groupID` as 'groupID', IF(    CHAR_LENGTH(`class_agent_selection1`.`selection_phase`), CONCAT_WS('',   `class_agent_selection1`.`selection_phase`), '') as 'selection_class', IF(    CHAR_LENGTH(`class_agent_type11`.`type`), CONCAT_WS('',   `class_agent_type11`.`type`), '') as 'agenttype1', IF(    CHAR_LENGTH(`class_agent_type21`.`type`), CONCAT_WS('',   `class_agent_type21`.`type`), '') as 'agenttype2', IF(    CHAR_LENGTH(`class_gender1`.`gender`), CONCAT_WS('',   `class_gender1`.`gender`), '') as 'gender', `game_agent`.`last_name` as 'last_name', `game_agent`.`first_name` as 'first_name', `game_agent`.`other_name` as 'other_name', DATE_FORMAT(`game_agent`.`birthday`, '%Y-%m-%d %H:%i') as 'birthday', `game_agent`.`birth_location` as 'birth_location', `game_agent`.`birth_location_map` as 'birth_location_map', DATE_FORMAT(`game_agent`.`deathday`, '%Y-%m-%d %H:%i') as 'deathday', `game_agent`.`death_location` as 'death_location', `game_agent`.`workplace` as 'workplace', `game_agent`.`knows` as 'knows', `game_agent`.`shortbio` as 'shortbio', IF(    CHAR_LENGTH(`class_evaluation1`.`evaluation_type`), CONCAT_WS('',   `class_evaluation1`.`evaluation_type`), '') as 'data_evaluation', `game_agent`.`viaf_no` as 'viaf_no', `game_agent`.`authority_record` as 'authority_record', IF(    CHAR_LENGTH(`class_authority_agent1`.`abbreviation`) || CHAR_LENGTH(`class_authority_agent1`.`authority_name`), CONCAT_WS('',   `class_authority_agent1`.`abbreviation`, '   ', `class_authority_agent1`.`authority_name`), '') as 'authority_organization' FROM `game_agent` LEFT JOIN `class_agent_selection` as class_agent_selection1 ON `class_agent_selection1`.`id`=`game_agent`.`selection_class` LEFT JOIN `class_agent_type1` as class_agent_type11 ON `class_agent_type11`.`id`=`game_agent`.`agenttype1` LEFT JOIN `class_agent_type2` as class_agent_type21 ON `class_agent_type21`.`id`=`game_agent`.`agenttype2` LEFT JOIN `class_gender` as class_gender1 ON `class_gender1`.`id`=`game_agent`.`gender` LEFT JOIN `class_evaluation` as class_evaluation1 ON `class_evaluation1`.`id`=`game_agent`.`data_evaluation` LEFT JOIN `class_authority_agent` as class_authority_agent1 ON `class_authority_agent1`.`id`=`game_agent`.`authority_organization`  WHERE `game_agent`.`id`='{$id}' limit 1", $eo);
			$row = db_fetch_assoc($res);
			?>
			$j('#agent_name<?php echo $rnd1; ?>').html('<?php echo addslashes(str_replace(array("\r", "\n"), '', nl2br($row['last_name'].', '.$row['first_name']))); ?>&nbsp;');
			<?php
			break;

		case 'bio_storyline_no':
			if(!$id) {
				?>
				$j('#bio_storyline_text<?php echo $rnd1; ?>').html('&nbsp;');
				<?php
				break;
			}
			$res = sql("SELECT `bio_storyline`.`id` as 'id', IF(    CHAR_LENGTH(`bio_story1`.`id`) || CHAR_LENGTH(`bio_story1`.`story_title`), CONCAT_WS('',   `bio_story1`.`id`, ' -  ', `bio_story1`.`story_title`), '') as 'biography', IF(    CHAR_LENGTH(`biblio_author1`.`id`) || CHAR_LENGTH(`biblio_author1`.`memberID`), CONCAT_WS('',   `biblio_author1`.`id`, '   ', `biblio_author1`.`memberID`), '') as 'author_id', IF(    CHAR_LENGTH(`biblio_author1`.`last_name`) || CHAR_LENGTH(`biblio_author1`.`first_name`), CONCAT_WS('',   `biblio_author1`.`last_name`, ', ', `biblio_author1`.`first_name`), '') as 'author_name', IF(    CHAR_LENGTH(`biblio_doc1`.`id`) || CHAR_LENGTH(`biblio_doc1`.`title`), CONCAT_WS('',   `biblio_doc1`.`id`, ' - ', `biblio_doc1`.`title`), '') as 'bibliography', IF(    CHAR_LENGTH(`biblio_transcript1`.`id`) || CHAR_LENGTH(`biblio_transcript1`.`transcript_title`), CONCAT_WS('',   `biblio_transcript1`.`id`, ' - ', `biblio_transcript1`.`transcript_title`), '') as 'transcript', IF(    CHAR_LENGTH(`biblio_token1`.`id`) || CHAR_LENGTH(`biblio_token1`.`token_sequence`), CONCAT_WS('',   `biblio_token1`.`id`, ' - ', `biblio_token1`.`token_sequence`), '') as 'token_sequence', IF(    CHAR_LENGTH(`biblio_token1`.`token`), CONCAT_WS('',   `biblio_token1`.`token`), '') as 'token', IF(    CHAR_LENGTH(`class_story_acts1`.`act`), CONCAT_WS('',   `class_story_acts1`.`act`), '') as 'story_act', `bio_storyline`.`sequence` as 'sequence', IF(    CHAR_LENGTH(`game_agent1`.`id`) || CHAR_LENGTH(`game_agent1`.`memberID`) || CHAR_LENGTH(`game_agent1`.`last_name`) || CHAR_LENGTH(`game_agent1`.`first_name`), CONCAT_WS('',   `game_agent1`.`id`, '   ', `game_agent1`.`memberID`, `game_agent1`.`last_name`, ', ', `game_agent1`.`first_name`), '') as 'character', IF(    CHAR_LENGTH(`class_dramatica_character1`.`character`) || CHAR_LENGTH(`bio_chr1`.`role`), CONCAT_WS('',   `class_dramatica_character1`.`character`, ' - ', `bio_chr1`.`role`), '') as 'role', `bio_storyline`.`storyline_no` as 'storyline_no', `bio_storyline`.`parenthetic` as 'parenthetic', `bio_storyline`.`storyline_title` as 'storyline_title', `bio_storyline`.`storyline` as 'storyline', `bio_storyline`.`notes` as 'notes', IF(    CHAR_LENGTH(`class_dramatica_steps1`.`step`), CONCAT_WS('',   `class_dramatica_steps1`.`step`), '') as 'storyweaving_scene_no', IF(    CHAR_LENGTH(`bio_storyweaving_scene1`.`id`), CONCAT_WS('',   `bio_storyweaving_scene1`.`id`), '') as 'storyweaving_scene', IF(    CHAR_LENGTH(`bio_storyweaving_scene1`.`sequence`), CONCAT_WS('',   `bio_storyweaving_scene1`.`sequence`), '') as 'storyweaving_sequence', IF(    CHAR_LENGTH(`class_dramatica_themes1`.`theme`), CONCAT_WS('',   `class_dramatica_themes1`.`theme`), '') as 'storyweaving_theme', IF(    CHAR_LENGTH(`bio_chr_scene1`.`id`) || CHAR_LENGTH(`bio_chr_scene1`.`scene`), CONCAT_WS('',   `bio_chr_scene1`.`id`, '   ', `bio_chr_scene1`.`scene`), '') as 'character_scene', IF(    CHAR_LENGTH(`bio_encounter_scene1`.`scene`), CONCAT_WS('',   `bio_encounter_scene1`.`scene`), '') as 'character_event', if(`bio_storyline`.`startdate`,date_format(`bio_storyline`.`startdate`,'%d/%m/%Y %H:%i'),'') as 'startdate', if(`bio_storyline`.`enddate`,date_format(`bio_storyline`.`enddate`,'%d/%m/%Y %H:%i'),'') as 'enddate' FROM `bio_storyline` LEFT JOIN `bio_story` as bio_story1 ON `bio_story1`.`id`=`bio_storyline`.`biography` LEFT JOIN `biblio_author` as biblio_author1 ON `biblio_author1`.`id`=`bio_storyline`.`author_id` LEFT JOIN `biblio_doc` as biblio_doc1 ON `biblio_doc1`.`id`=`bio_storyline`.`bibliography` LEFT JOIN `biblio_transcript` as biblio_transcript1 ON `biblio_transcript1`.`id`=`bio_storyline`.`transcript` LEFT JOIN `biblio_token` as biblio_token1 ON `biblio_token1`.`id`=`bio_storyline`.`token` LEFT JOIN `class_story_acts` as class_story_acts1 ON `class_story_acts1`.`id`=`bio_storyline`.`story_act` LEFT JOIN `bio_chr` as bio_chr1 ON `bio_chr1`.`id`=`bio_storyline`.`character` LEFT JOIN `game_agent` as game_agent1 ON `game_agent1`.`id`=`bio_chr1`.`agent_id` LEFT JOIN `bio_storyweaving_scene` as bio_storyweaving_scene1 ON `bio_storyweaving_scene1`.`id`=`bio_storyline`.`storyweaving_scene_no` LEFT JOIN `class_dramatica_steps` as class_dramatica_steps1 ON `class_dramatica_steps1`.`id`=`bio_storyweaving_scene1`.`step` LEFT JOIN `bio_chr_scene` as bio_chr_scene1 ON `bio_chr_scene1`.`id`=`bio_storyline`.`character_scene` LEFT JOIN `bio_encounter_scene` as bio_encounter_scene1 ON `bio_encounter_scene1`.`id`=`bio_storyline`.`character_event` LEFT JOIN `class_dramatica_character` as class_dramatica_character1 ON `class_dramatica_character1`.`id`=`bio_chr1`.`bio_character` LEFT JOIN `class_dramatica_themes` as class_dramatica_themes1 ON `class_dramatica_themes1`.`id`=`bio_storyweaving_scene1`.`theme`  WHERE `bio_storyline`.`id`='{$id}' limit 1", $eo);
			$row = db_fetch_assoc($res);
			?>
			$j('#bio_storyline_text<?php echo $rnd1; ?>').html('<?php echo addslashes(str_replace(array("\r", "\n"), '', nl2br($row['id'].'- '.$row['storyline']))); ?>&nbsp;');
			<?php
			break;


	}

?>