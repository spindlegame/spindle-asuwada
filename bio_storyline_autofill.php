<?php
// This script and data application were generated by AppGini 5.94
// Download AppGini for free from https://bigprof.com/appgini/download/

	$currDir = dirname(__FILE__);
	include_once("$currDir/lib.php");

	handle_maintenance();

	header('Content-type: text/javascript; charset=' . datalist_db_encoding);

	$table_perms = getTablePermissions('bio_storyline');
	if(!$table_perms['access']) die('// Access denied!');

	$mfk = $_GET['mfk'];
	$id = makeSafe($_GET['id']);
	$rnd1 = intval($_GET['rnd1']); if(!$rnd1) $rnd1 = '';

	if(!$mfk) {
		die('// No js code available!');
	}

	switch($mfk) {

		case 'author_id':
			if(!$id) {
				?>
				$j('#author_name<?php echo $rnd1; ?>').html('&nbsp;');
				<?php
				break;
			}
			$res = sql("SELECT `biblio_author`.`id` as 'id', IF(    CHAR_LENGTH(`biblio_team1`.`team`), CONCAT_WS('',   `biblio_team1`.`team`), '') as 'team', IF(    CHAR_LENGTH(`game_agent1`.`id`) || CHAR_LENGTH(`game_agent1`.`memberID`), CONCAT_WS('',   `game_agent1`.`id`, '   ', `game_agent1`.`memberID`), '') as 'author_id', IF(    CHAR_LENGTH(`game_agent1`.`memberID`), CONCAT_WS('',   `game_agent1`.`memberID`), '') as 'author_memberid', IF(    CHAR_LENGTH(`game_agent1`.`last_name`), CONCAT_WS('',   `game_agent1`.`last_name`), '') as 'last_name', IF(    CHAR_LENGTH(`game_agent1`.`first_name`), CONCAT_WS('',   `game_agent1`.`first_name`), '') as 'first_name', IF(    CHAR_LENGTH(`game_agent1`.`other_name`), CONCAT_WS('',   `game_agent1`.`other_name`), '') as 'other_name', `biblio_author`.`viaf_no` as 'viaf_no', IF(    CHAR_LENGTH(`class_authority_agent1`.`abbreviation`) || CHAR_LENGTH(`class_authority_agent1`.`authority_name`), CONCAT_WS('',   `class_authority_agent1`.`abbreviation`, '   ', `class_authority_agent1`.`authority_name`), '') as 'authority_organization', `biblio_author`.`authority_code` as 'authority_code', `biblio_author`.`viaf_link` as 'viaf_link', `biblio_author`.`authority_link` as 'authority_link', IF(    CHAR_LENGTH(`class_evaluation1`.`evaluation_type`), CONCAT_WS('',   `class_evaluation1`.`evaluation_type`), '') as 'data_evaluation' FROM `biblio_author` LEFT JOIN `biblio_team` as biblio_team1 ON `biblio_team1`.`id`=`biblio_author`.`team` LEFT JOIN `game_agent` as game_agent1 ON `game_agent1`.`id`=`biblio_author`.`author_id` LEFT JOIN `class_authority_agent` as class_authority_agent1 ON `class_authority_agent1`.`id`=`biblio_author`.`authority_organization` LEFT JOIN `class_evaluation` as class_evaluation1 ON `class_evaluation1`.`id`=`biblio_author`.`data_evaluation`  WHERE `biblio_author`.`id`='{$id}' limit 1", $eo);
			$row = db_fetch_assoc($res);
			?>
			$j('#author_name<?php echo $rnd1; ?>').html('<?php echo addslashes(str_replace(array("\r", "\n"), '', nl2br($row['last_name'].', '.$row['first_name']))); ?>&nbsp;');
			<?php
			break;

		case 'token':
			if(!$id) {
				?>
				$j('#token_sequence<?php echo $rnd1; ?>').html('&nbsp;');
				<?php
				break;
			}
			$res = sql("SELECT `biblio_token`.`id` as 'id', IF(    CHAR_LENGTH(`biblio_author1`.`id`) || CHAR_LENGTH(`biblio_author1`.`author_memberid`), CONCAT_WS('',   `biblio_author1`.`id`, '   ', `biblio_author1`.`author_memberid`), '') as 'author_id', IF(    CHAR_LENGTH(`biblio_author1`.`last_name`) || CHAR_LENGTH(`biblio_author1`.`first_name`), CONCAT_WS('',   `biblio_author1`.`last_name`, ', ', `biblio_author1`.`first_name`), '') as 'author_name', IF(    CHAR_LENGTH(`biblio_doc1`.`id`) || CHAR_LENGTH(`biblio_doc1`.`title`), CONCAT_WS('',   `biblio_doc1`.`id`, '   ', `biblio_doc1`.`title`), '') as 'bibliography', IF(    CHAR_LENGTH(`biblio_transcript1`.`id`) || CHAR_LENGTH(`biblio_transcript1`.`transcript_title`), CONCAT_WS('',   `biblio_transcript1`.`id`, '   ', `biblio_transcript1`.`transcript_title`), '') as 'transcript', `biblio_token`.`token_sequence` as 'token_sequence', `biblio_token`.`token` as 'token', IF(    CHAR_LENGTH(`biblio_team1`.`team`), CONCAT_WS('',   `biblio_team1`.`team`), '') as 'team', IF(    CHAR_LENGTH(`biblio_analyst1`.`last_name`) || CHAR_LENGTH(`biblio_analyst1`.`first_name`), CONCAT_WS('',   `biblio_analyst1`.`last_name`, ', ', `biblio_analyst1`.`first_name`), '') as 'biblio_lead', IF(    CHAR_LENGTH(`class_evaluation1`.`evaluation_type`), CONCAT_WS('',   `class_evaluation1`.`evaluation_type`), '') as 'data_evaluation' FROM `biblio_token` LEFT JOIN `biblio_author` as biblio_author1 ON `biblio_author1`.`id`=`biblio_token`.`author_id` LEFT JOIN `biblio_doc` as biblio_doc1 ON `biblio_doc1`.`id`=`biblio_token`.`bibliography` LEFT JOIN `biblio_transcript` as biblio_transcript1 ON `biblio_transcript1`.`id`=`biblio_token`.`transcript` LEFT JOIN `biblio_team` as biblio_team1 ON `biblio_team1`.`id`=`biblio_token`.`team` LEFT JOIN `biblio_analyst` as biblio_analyst1 ON `biblio_analyst1`.`id`=`biblio_token`.`biblio_lead` LEFT JOIN `class_evaluation` as class_evaluation1 ON `class_evaluation1`.`id`=`biblio_token`.`data_evaluation`  WHERE `biblio_token`.`id`='{$id}' limit 1", $eo);
			$row = db_fetch_assoc($res);
			?>
			$j('#token_sequence<?php echo $rnd1; ?>').html('<?php echo addslashes(str_replace(array("\r", "\n"), '', nl2br($row['id'].' - '.$row['token_sequence']))); ?>&nbsp;');
			<?php
			break;

		case 'character':
			if(!$id) {
				?>
				$j('#role<?php echo $rnd1; ?>').html('&nbsp;');
				<?php
				break;
			}
			$res = sql("SELECT `bio_chr`.`id` as 'id', `bio_chr`.`img` as 'img', IF(    CHAR_LENGTH(`bio_author1`.`id`) || CHAR_LENGTH(`bio_author1`.`author_memberid`), CONCAT_WS('',   `bio_author1`.`id`, '   ', `bio_author1`.`author_memberid`), '') as 'author_id', IF(    CHAR_LENGTH(`bio_author1`.`last_name`) || CHAR_LENGTH(`bio_author1`.`first_name`), CONCAT_WS('',   `bio_author1`.`last_name`, ', ', `bio_author1`.`first_name`), '') as 'author_name', IF(    CHAR_LENGTH(`game_agent1`.`id`) || CHAR_LENGTH(`game_agent1`.`memberID`), CONCAT_WS('',   `game_agent1`.`id`, '   ', `game_agent1`.`memberID`), '') as 'agent_id', IF(    CHAR_LENGTH(`game_agent1`.`last_name`) || CHAR_LENGTH(`game_agent1`.`first_name`), CONCAT_WS('',   `game_agent1`.`last_name`, ', ', `game_agent1`.`first_name`), '') as 'agent_name', IF(    CHAR_LENGTH(`bio_story1`.`id`) || CHAR_LENGTH(`bio_story1`.`story_title`), CONCAT_WS('',   `bio_story1`.`id`, ' - ', `bio_story1`.`story_title`), '') as 'bio_story', IF(    CHAR_LENGTH(`class_dramatica_character1`.`character`), CONCAT_WS('',   `class_dramatica_character1`.`character`), '') as 'bio_character', IF(    CHAR_LENGTH(`class_dramatica_archetype1`.`archetype`), CONCAT_WS('',   `class_dramatica_archetype1`.`archetype`, ' '), '') as 'bio_archetype', `bio_chr`.`character_name` as 'character_name', `bio_chr`.`role` as 'role', `bio_chr`.`comment` as 'comment' FROM `bio_chr` LEFT JOIN `bio_author` as bio_author1 ON `bio_author1`.`id`=`bio_chr`.`author_id` LEFT JOIN `game_agent` as game_agent1 ON `game_agent1`.`id`=`bio_chr`.`agent_id` LEFT JOIN `bio_story` as bio_story1 ON `bio_story1`.`id`=`bio_chr`.`bio_story` LEFT JOIN `class_dramatica_character` as class_dramatica_character1 ON `class_dramatica_character1`.`id`=`bio_chr`.`bio_character` LEFT JOIN `class_dramatica_archetype` as class_dramatica_archetype1 ON `class_dramatica_archetype1`.`id`=`bio_chr`.`bio_archetype`  WHERE `bio_chr`.`id`='{$id}' limit 1", $eo);
			$row = db_fetch_assoc($res);
			?>
			$j('#role<?php echo $rnd1; ?>').html('<?php echo addslashes(str_replace(array("\r", "\n"), '', nl2br($row['bio_character'].' - '.$row['role']))); ?>&nbsp;');
			<?php
			break;

		case 'storyweaving_scene_no':
			if(!$id) {
				?>
				$j('#storyweaving_scene<?php echo $rnd1; ?>').html('&nbsp;');
				$j('#storyweaving_sequence<?php echo $rnd1; ?>').html('&nbsp;');
				$j('#storyweaving_theme<?php echo $rnd1; ?>').html('&nbsp;');
				<?php
				break;
			}
			$res = sql("SELECT `bio_storyweaving_scene`.`id` as 'id', IF(    CHAR_LENGTH(`bio_story1`.`id`) || CHAR_LENGTH(`bio_story1`.`story_title`), CONCAT_WS('',   `bio_story1`.`id`, '   ', `bio_story1`.`story_title`), '') as 'story', IF(    CHAR_LENGTH(`class_dramatica_steps1`.`step`), CONCAT_WS('',   `class_dramatica_steps1`.`step`), '') as 'step', IF(    CHAR_LENGTH(`class_dramatica_throughline1`.`throughline`), CONCAT_WS('',   `class_dramatica_throughline1`.`throughline`), '') as 'throughline', IF(    CHAR_LENGTH(`class_dramatica_domain1`.`domain`), CONCAT_WS('',   `class_dramatica_domain1`.`domain`), '') as 'domain', IF(    CHAR_LENGTH(`class_dramatica_concern1`.`concern`), CONCAT_WS('',   `class_dramatica_concern1`.`concern`), '') as 'concern', IF(    CHAR_LENGTH(`class_dramatica_issue1`.`issue`), CONCAT_WS('',   `class_dramatica_issue1`.`issue`), '') as 'issue', IF(    CHAR_LENGTH(`class_dramatica_themes1`.`theme`), CONCAT_WS('',   `class_dramatica_themes1`.`theme`), '') as 'theme', `bio_storyweaving_scene`.`sequence` as 'sequence', `bio_storyweaving_scene`.`encoding` as 'encoding' FROM `bio_storyweaving_scene` LEFT JOIN `bio_story` as bio_story1 ON `bio_story1`.`id`=`bio_storyweaving_scene`.`story` LEFT JOIN `class_dramatica_steps` as class_dramatica_steps1 ON `class_dramatica_steps1`.`id`=`bio_storyweaving_scene`.`step` LEFT JOIN `class_dramatica_throughline` as class_dramatica_throughline1 ON `class_dramatica_throughline1`.`id`=`bio_storyweaving_scene`.`throughline` LEFT JOIN `class_dramatica_domain` as class_dramatica_domain1 ON `class_dramatica_domain1`.`id`=`bio_storyweaving_scene`.`domain` LEFT JOIN `class_dramatica_concern` as class_dramatica_concern1 ON `class_dramatica_concern1`.`id`=`bio_storyweaving_scene`.`concern` LEFT JOIN `class_dramatica_issue` as class_dramatica_issue1 ON `class_dramatica_issue1`.`id`=`bio_storyweaving_scene`.`issue` LEFT JOIN `class_dramatica_themes` as class_dramatica_themes1 ON `class_dramatica_themes1`.`id`=`bio_storyweaving_scene`.`theme`  WHERE `bio_storyweaving_scene`.`id`='{$id}' limit 1", $eo);
			$row = db_fetch_assoc($res);
			?>
			$j('#storyweaving_scene<?php echo $rnd1; ?>').html('<?php echo addslashes(str_replace(array("\r", "\n"), '', nl2br($row['id']))); ?>&nbsp;');
			$j('#storyweaving_sequence<?php echo $rnd1; ?>').html('<?php echo addslashes(str_replace(array("\r", "\n"), '', nl2br($row['sequence']))); ?>&nbsp;');
			$j('#storyweaving_theme<?php echo $rnd1; ?>').html('<?php echo addslashes(str_replace(array("\r", "\n"), '', nl2br($row['theme']))); ?>&nbsp;');
			<?php
			break;

		case 'character_scene':
			if(!$id) {
				?>
				$j('#startdate<?php echo $rnd1; ?>').html('&nbsp;');
				$j('#enddate<?php echo $rnd1; ?>').html('&nbsp;');
				<?php
				break;
			}
			$res = sql("SELECT `bio_chr_scene`.`id` as 'id', IF(    CHAR_LENGTH(`bio_story1`.`id`) || CHAR_LENGTH(`bio_story1`.`story_title`), CONCAT_WS('',   `bio_story1`.`id`, ' - ', `bio_story1`.`story_title`), '') as 'biography', IF(    CHAR_LENGTH(`biblio_author1`.`id`) || CHAR_LENGTH(`biblio_author1`.`author_memberid`), CONCAT_WS('',   `biblio_author1`.`id`, '    ', `biblio_author1`.`author_memberid`), '') as 'author_id', IF(    CHAR_LENGTH(`biblio_author1`.`last_name`) || CHAR_LENGTH(`biblio_author1`.`first_name`), CONCAT_WS('',   `biblio_author1`.`last_name`, ', ', `biblio_author1`.`first_name`), '') as 'author_name', IF(    CHAR_LENGTH(`biblio_doc1`.`id`) || CHAR_LENGTH(`biblio_doc1`.`title`), CONCAT_WS('',   `biblio_doc1`.`id`, '    ', `biblio_doc1`.`title`), '') as 'bibliography', IF(    CHAR_LENGTH(`biblio_transcript1`.`id`) || CHAR_LENGTH(`biblio_transcript1`.`transcript_title`), CONCAT_WS('',   `biblio_transcript1`.`id`, '   ', `biblio_transcript1`.`transcript_title`), '') as 'transcript', IF(    CHAR_LENGTH(`biblio_token1`.`id`) || CHAR_LENGTH(`biblio_token1`.`token_sequence`), CONCAT_WS('',   `biblio_token1`.`id`, '   ', `biblio_token1`.`token_sequence`), '') as 'token_sequence', IF(    CHAR_LENGTH(`biblio_token1`.`token`), CONCAT_WS('',   `biblio_token1`.`token`), '') as 'token', IF(    CHAR_LENGTH(`biblio_code_invivo1`.`invivo`), CONCAT_WS('',   `biblio_code_invivo1`.`invivo`), '') as 'invivo_code', IF(    CHAR_LENGTH(if(`biblio_code_invivo2`.`start_date`,date_format(`biblio_code_invivo2`.`start_date`,'%d/%m/%Y %H:%i'),'')) || CHAR_LENGTH(if(`biblio_code_invivo2`.`end_date`,date_format(`biblio_code_invivo2`.`end_date`,'%d/%m/%Y %H:%i'),'')), CONCAT_WS('',   if(`biblio_code_invivo2`.`start_date`,date_format(`biblio_code_invivo2`.`start_date`,'%d/%m/%Y %H:%i'),''), ' - ', if(`biblio_code_invivo2`.`end_date`,date_format(`biblio_code_invivo2`.`end_date`,'%d/%m/%Y %H:%i'),'')), '') as 'startdate', IF(    CHAR_LENGTH(if(`biblio_code_invivo1`.`end_date`,date_format(`biblio_code_invivo1`.`end_date`,'%d/%m/%Y %H:%i'),'')), CONCAT_WS('',   if(`biblio_code_invivo1`.`end_date`,date_format(`biblio_code_invivo1`.`end_date`,'%d/%m/%Y %H:%i'),'')), '') as 'enddate', IF(    CHAR_LENGTH(`biblio_code_invivo1`.`person`), CONCAT_WS('',   `biblio_code_invivo1`.`person`), '') as 'person', IF(    CHAR_LENGTH(`biblio_code_invivo1`.`place`), CONCAT_WS('',   `biblio_code_invivo1`.`place`), '') as 'place', IF(    CHAR_LENGTH(`bio_code_herme1`.`hermeneutic`), CONCAT_WS('',   `bio_code_herme1`.`hermeneutic`), '') as 'herme_code', IF(    CHAR_LENGTH(`class_im1`.`impression`), CONCAT_WS('',   `class_im1`.`impression`), '') as 'impression', IF(    CHAR_LENGTH(`class_nt1`.`noetictension`), CONCAT_WS('',   `class_nt1`.`noetictension`), '') as 'noetictension', IF(    CHAR_LENGTH(`class_pc1`.`perform_contrad`), CONCAT_WS('',   `class_pc1`.`perform_contrad`), '') as 'pc', IF(    CHAR_LENGTH(`class_counterfactual1`.`counterfactual`), CONCAT_WS('',   `class_counterfactual1`.`counterfactual`), '') as 'counterfactual', IF(    CHAR_LENGTH(`class_dilemma1`.`defense`), CONCAT_WS('',   `class_dilemma1`.`defense`), '') as 'goal', IF(    CHAR_LENGTH(`class_dilemma2`.`defense`), CONCAT_WS('',   `class_dilemma2`.`defense`), '') as 'dilemma_ethics', IF(    CHAR_LENGTH(`bio_code_herme1`.`id`), CONCAT_WS('',   `bio_code_herme1`.`id`, '   '), '') as 'sdg', IF(    CHAR_LENGTH(`class_character_element1`.`element`) || CHAR_LENGTH(`class_character_element1`.`value`), CONCAT_WS('',   `class_character_element1`.`element`, '- ', `class_character_element1`.`value`), '') as 'chr_element', `bio_chr_scene`.`comment` as 'comment', `bio_chr_scene`.`illustration` as 'illustration', `bio_chr_scene`.`scene` as 'scene' FROM `bio_chr_scene` LEFT JOIN `bio_story` as bio_story1 ON `bio_story1`.`id`=`bio_chr_scene`.`biography` LEFT JOIN `biblio_author` as biblio_author1 ON `biblio_author1`.`id`=`bio_chr_scene`.`author_id` LEFT JOIN `biblio_doc` as biblio_doc1 ON `biblio_doc1`.`id`=`bio_chr_scene`.`bibliography` LEFT JOIN `biblio_transcript` as biblio_transcript1 ON `biblio_transcript1`.`id`=`bio_chr_scene`.`transcript` LEFT JOIN `biblio_token` as biblio_token1 ON `biblio_token1`.`id`=`bio_chr_scene`.`token` LEFT JOIN `biblio_code_invivo` as biblio_code_invivo1 ON `biblio_code_invivo1`.`id`=`bio_chr_scene`.`invivo_code` LEFT JOIN `biblio_code_invivo` as biblio_code_invivo2 ON `biblio_code_invivo2`.`id`=`bio_chr_scene`.`startdate` LEFT JOIN `bio_code_herme` as bio_code_herme1 ON `bio_code_herme1`.`id`=`bio_chr_scene`.`herme_code` LEFT JOIN `class_character_element` as class_character_element1 ON `class_character_element1`.`id`=`bio_chr_scene`.`chr_element` LEFT JOIN `class_im` as class_im1 ON `class_im1`.`id`=`bio_code_herme1`.`impression` LEFT JOIN `class_nt` as class_nt1 ON `class_nt1`.`id`=`bio_code_herme1`.`noetictension` LEFT JOIN `class_pc` as class_pc1 ON `class_pc1`.`id`=`bio_code_herme1`.`pc` LEFT JOIN `class_counterfactual` as class_counterfactual1 ON `class_counterfactual1`.`id`=`bio_code_herme1`.`counterfactual` LEFT JOIN `class_dilemma` as class_dilemma1 ON `class_dilemma1`.`id`=`bio_code_herme1`.`bio_dilemma` LEFT JOIN `class_dilemma` as class_dilemma2 ON `class_dilemma2`.`id`=`bio_code_herme1`.`bio_dilemma`  WHERE `bio_chr_scene`.`id`='{$id}' limit 1", $eo);
			$row = db_fetch_assoc($res);
			?>
			$j('#startdate<?php echo $rnd1; ?>').html('<?php echo addslashes(str_replace(array("\r", "\n"), '', nl2br($row['startdate']))); ?>&nbsp;');
			$j('#enddate<?php echo $rnd1; ?>').html('<?php echo addslashes(str_replace(array("\r", "\n"), '', nl2br($row['enddate']))); ?>&nbsp;');
			<?php
			break;


	}

?>