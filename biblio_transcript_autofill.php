<?php
// This script and data application were generated by AppGini 5.94
// Download AppGini for free from https://bigprof.com/appgini/download/

	$currDir = dirname(__FILE__);
	include_once("$currDir/lib.php");

	handle_maintenance();

	header('Content-type: text/javascript; charset=' . datalist_db_encoding);

	$table_perms = getTablePermissions('biblio_transcript');
	if(!$table_perms['access']) die('// Access denied!');

	$mfk = $_GET['mfk'];
	$id = makeSafe($_GET['id']);
	$rnd1 = intval($_GET['rnd1']); if(!$rnd1) $rnd1 = '';

	if(!$mfk) {
		die('// No js code available!');
	}

	switch($mfk) {

		case 'author_memberID':
			if(!$id) {
				?>
				$j('#author<?php echo $rnd1; ?>').html('&nbsp;');
				<?php
				break;
			}
			$res = sql("SELECT `biblio_author`.`id` as 'id', IF(    CHAR_LENGTH(`biblio_team1`.`team`), CONCAT_WS('',   `biblio_team1`.`team`), '') as 'team', IF(    CHAR_LENGTH(`game_agent1`.`id`) || CHAR_LENGTH(`game_agent1`.`memberID`), CONCAT_WS('',   `game_agent1`.`id`, '   ', `game_agent1`.`memberID`), '') as 'author_id', IF(    CHAR_LENGTH(`game_agent1`.`memberID`), CONCAT_WS('',   `game_agent1`.`memberID`), '') as 'author_memberid', IF(    CHAR_LENGTH(`game_agent1`.`last_name`), CONCAT_WS('',   `game_agent1`.`last_name`), '') as 'last_name', IF(    CHAR_LENGTH(`game_agent1`.`first_name`), CONCAT_WS('',   `game_agent1`.`first_name`), '') as 'first_name', IF(    CHAR_LENGTH(`game_agent1`.`other_name`), CONCAT_WS('',   `game_agent1`.`other_name`), '') as 'other_name', `biblio_author`.`viaf_no` as 'viaf_no', IF(    CHAR_LENGTH(`class_authority_agent1`.`abbreviation`) || CHAR_LENGTH(`class_authority_agent1`.`authority_name`), CONCAT_WS('',   `class_authority_agent1`.`abbreviation`, '   ', `class_authority_agent1`.`authority_name`), '') as 'authority_organization', `biblio_author`.`authority_code` as 'authority_code', `biblio_author`.`viaf_link` as 'viaf_link', `biblio_author`.`authority_link` as 'authority_link', IF(    CHAR_LENGTH(`class_evaluation1`.`evaluation_type`), CONCAT_WS('',   `class_evaluation1`.`evaluation_type`), '') as 'data_evaluation' FROM `biblio_author` LEFT JOIN `biblio_team` as biblio_team1 ON `biblio_team1`.`id`=`biblio_author`.`team` LEFT JOIN `game_agent` as game_agent1 ON `game_agent1`.`id`=`biblio_author`.`author_id` LEFT JOIN `class_authority_agent` as class_authority_agent1 ON `class_authority_agent1`.`id`=`biblio_author`.`authority_organization` LEFT JOIN `class_evaluation` as class_evaluation1 ON `class_evaluation1`.`id`=`biblio_author`.`data_evaluation`  WHERE `biblio_author`.`id`='{$id}' limit 1", $eo);
			$row = db_fetch_assoc($res);
			?>
			$j('#author<?php echo $rnd1; ?>').html('<?php echo addslashes(str_replace(array("\r", "\n"), '', nl2br($row['last_name'].', '.$row['first_name']))); ?>&nbsp;');
			<?php
			break;

		case 'bibliography_title':
			if(!$id) {
				?>
				$j('#bibliography_id<?php echo $rnd1; ?>').html('&nbsp;');
				<?php
				break;
			}
			$res = sql("SELECT `biblio_doc`.`id` as 'id', `biblio_doc`.`img` as 'img', IF(    CHAR_LENGTH(`biblio_author1`.`last_name`) || CHAR_LENGTH(`biblio_author1`.`first_name`), CONCAT_WS('',   `biblio_author1`.`last_name`, ', ', `biblio_author1`.`first_name`), '') as 'author_name', IF(    CHAR_LENGTH(`biblio_author1`.`id`) || CHAR_LENGTH(`biblio_author1`.`author_memberid`), CONCAT_WS('',   `biblio_author1`.`id`, '    ', `biblio_author1`.`author_memberid`), '') as 'author_id', IF(    CHAR_LENGTH(`class_bibliography_type1`.`type`), CONCAT_WS('',   `class_bibliography_type1`.`type`), '') as 'type', IF(    CHAR_LENGTH(`class_bibliography_genre1`.`genre`), CONCAT_WS('',   `class_bibliography_genre1`.`genre`), '') as 'genre', if(`biblio_doc`.`created`,date_format(`biblio_doc`.`created`,'%d/%m/%Y %H:%i'),'') as 'created', if(`biblio_doc`.`published`,date_format(`biblio_doc`.`published`,'%d/%m/%Y %H:%i'),'') as 'published', `biblio_doc`.`title` as 'title', `biblio_doc`.`subtitle` as 'subtitle', `biblio_doc`.`publisher` as 'publisher', `biblio_doc`.`location` as 'location', `biblio_doc`.`citation` as 'citation', `biblio_doc`.`description` as 'description', `biblio_doc`.`source` as 'source', IF(    CHAR_LENGTH(`class_bibliography_media1`.`definition`), CONCAT_WS('',   `class_bibliography_media1`.`definition`), '') as 'medium', IF(    CHAR_LENGTH(`class_language1`.`short`) || CHAR_LENGTH(`class_language1`.`language`), CONCAT_WS('',   `class_language1`.`short`, '   ', `class_language1`.`language`), '') as 'language', `biblio_doc`.`format` as 'format', `biblio_doc`.`subject` as 'subject', IF(    CHAR_LENGTH(`class_rights1`.`right`), CONCAT_WS('',   `class_rights1`.`right`), '') as 'rights', `biblio_doc`.`rights_holder` as 'rights_holder', `biblio_doc`.`world_cat_no` as 'world_cat_no', IF(    CHAR_LENGTH(`class_authority_library1`.`abbreviation`) || CHAR_LENGTH(`class_authority_library1`.`authority_name`), CONCAT_WS('',   `class_authority_library1`.`abbreviation`, '   ', `class_authority_library1`.`authority_name`), '') as 'authority_organization', `biblio_doc`.`authority_code` as 'authority_code', `biblio_doc`.`pdf_book` as 'pdf_book', `biblio_doc`.`ext_source` as 'ext_source', `biblio_doc`.`tags` as 'tags', IF(    CHAR_LENGTH(`biblio_team1`.`team`), CONCAT_WS('',   `biblio_team1`.`team`), '') as 'team', IF(    CHAR_LENGTH(`biblio_analyst1`.`last_name`) || CHAR_LENGTH(`biblio_analyst1`.`first_name`), CONCAT_WS('',   `biblio_analyst1`.`last_name`, ', ', `biblio_analyst1`.`first_name`), '') as 'biblio_lead', IF(    CHAR_LENGTH(`class_evaluation1`.`evaluation_type`), CONCAT_WS('',   `class_evaluation1`.`evaluation_type`), '') as 'data_evaluation' FROM `biblio_doc` LEFT JOIN `biblio_author` as biblio_author1 ON `biblio_author1`.`id`=`biblio_doc`.`author_id` LEFT JOIN `class_bibliography_type` as class_bibliography_type1 ON `class_bibliography_type1`.`id`=`biblio_doc`.`type` LEFT JOIN `class_bibliography_genre` as class_bibliography_genre1 ON `class_bibliography_genre1`.`id`=`biblio_doc`.`genre` LEFT JOIN `class_bibliography_media` as class_bibliography_media1 ON `class_bibliography_media1`.`id`=`biblio_doc`.`medium` LEFT JOIN `class_language` as class_language1 ON `class_language1`.`id`=`biblio_doc`.`language` LEFT JOIN `class_rights` as class_rights1 ON `class_rights1`.`id`=`biblio_doc`.`rights` LEFT JOIN `class_authority_library` as class_authority_library1 ON `class_authority_library1`.`id`=`biblio_doc`.`authority_organization` LEFT JOIN `biblio_team` as biblio_team1 ON `biblio_team1`.`id`=`biblio_doc`.`team` LEFT JOIN `biblio_analyst` as biblio_analyst1 ON `biblio_analyst1`.`id`=`biblio_doc`.`biblio_lead` LEFT JOIN `class_evaluation` as class_evaluation1 ON `class_evaluation1`.`id`=`biblio_doc`.`data_evaluation`  WHERE `biblio_doc`.`id`='{$id}' limit 1", $eo);
			$row = db_fetch_assoc($res);
			?>
			$j('#bibliography_id<?php echo $rnd1; ?>').html('<?php echo addslashes(str_replace(array("\r", "\n"), '', nl2br($row['id']))); ?>&nbsp;');
			<?php
			break;


	}

?>